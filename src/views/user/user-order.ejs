<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="./style/base.css">
    <link rel="stylesheet" href="./style/grid.css">
    <link rel="stylesheet" href="./style/main.css">
    <link rel="stylesheet" href="./style/home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/d72dd2144a.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./style/responsive.css">
    <link rel="stylesheet" href="/style/profile.css">
    <script>
        const list_item = JSON.parse('<%- JSON.stringify(items) %>');
        const user = JSON.parse('<%- JSON.stringify(user) %>');
        const myCart = JSON.parse('<%- JSON.stringify(myCart) %>');
        const orderDetails = JSON.parse('<%- JSON.stringify(order_details) %>');
        const orders = JSON.parse('<%- JSON.stringify(orders) %>');

        console.log(orderDetails,orders)

    </script>
    <title>TS-shop</title>
</head>
<body>
    <!-- Container start -->
    <div class="app">
        <div class="over-play"></div>
        <!-- Header start1-->
        <header class="header header-only">
            <div class="grid wide">
                <div class="header-category-box">
                    <i class="fa-solid fa-bars"></i>
                </div>
                <a href="/" class="header__logo"><img src="./image/logo.png" alt="logo" class="logo-img"></a>
                <form class="header__search" method="get" action="./category.html">
                    <input type="text" placeholder="何にをお探しですか？" class="header__search-input" name ="word">
                    <button class="header__search-button"><i class="fa-solid fa-magnifying-glass"></i></button>
                    <div class="header__search-box">
                    </div>
                </form>
                <ul class="header__navbar">
                    <li class="header__navbar-user">
                        <!-- ログインしてないとき -->
                        <% if (!user) { %>
                        <a href="/login"><i class="fa-regular fa-user"></i><span>ログイン</span></a>
                        <!-- ログインしたとき -->
                        <% } else{ %>
                        <a href="/user-profile"><img class="user-image" src="/image/user-image/<%=user.user_img %>" alt=""></a>
                        <div class="user_navbar">
                            <div class="dropdown-username"><%= user.user_name %></div>
                            <% if(user.user_role === 'admin'){ %>
                                <a href="/admin-page" class="dropdown-account">管理ページ</a>
                            <% } %>
                            <a href="/user-profile" class="dropdown-account">プロフィール</a>
                            <a href="/user-order" class="dropdown-purchase-history">注文履歴</a>
                            <a href="/logout" class="dropdown-logout">サインアウト</a>
                        </div>
                        <% } %>

                    </li>
                    <li class="header__navbar-like icon-center">
                        <a href="/user-favorite">
                            <i class="fa-regular fa-heart"></i>
                            <% if(user){if (user.favorItems.length > 0){ %>
                                <div class="header__navbar--favor-quality"><%=user.favorItems.length %></div>
                            <% }else{ %>
                                <div class="header__navbar--favor-quality" style="display: none;"></div>
                            <% }} %>
                        </a>
                    </li>
                    <div class="navbar-cart" onclick="renderMycart()">
                        <li class="header__navbar-cart icon-center">
                            <a >
                                <i class="fa-solid fa-cart-shopping"></i>
                            </a>
                            <div class="header__navbar-cart-count"></div>
                        </li>
                    </div>
                    <li class="header__navbar-support"><a href=""><i class="fa-solid fa-headset"></i><span>サポート</span></a></li>
                    <div class="header__navbar-cart-box-container">
                        <div class="header__navbar-cart-box">
                        </div>
                        <div class="row header__navbar-cart-box-closeBtn">
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                    </div>
                </ul>
            </div>   
        </header>
        <!-- Header end -->

        <!-- Container start -->
        <div class="container">
            <div class="grid wide">
                <div class="row">
                    <ul class="col l-3 user-profile__category">
                        <li class="user-profile__category--myacount"><a href="/user-profile"><i class="fa-solid fa-file-invoice"></i>アカウント管理</a></li>
                        <li class="user-profile__category--favor"><a href="/user-favorite"><i class="fa-solid fa-heart"></i>お気に入り</a></li>
                        <li class="user-profile__category--cart"><a href="/user-cart"><i class="fa-solid fa-cart-shopping"></i>買い物かご</a></li>
                        <li class="user-profile__category--hitory profile__category--checked"><a href="/user-order"><i class="fa-solid fa-clock-rotate-left"></i>注文履歴</a></li>
                        <li class="user-profile__category--signout"><a href="/logout"><i class="fa-solid fa-right-from-bracket"></i>サインアウト</a></li>
                    </ul>
                    <div class="col l-9 user-profile__content">
                        <div class="user-profile__content--title">注文履歴</div>
                        <div class="row user-profile__content--order-list">
                            <table class="order-list__item">
                                <tr>
                                    <th>商品情報</th>
                                    <th>支払い金額</th>
                                    <th>商品操作</th>
                                    <th>ステータス</th>
                                    <th>注文操作</th>
                                </tr>
                                <% orders.forEach(order => { %>
                                <tr>
                                    <td colspan="5" class="order-list__item--data">
                                        <div class="order-date"><%= order.order_date %>&nbsp;&nbsp;&nbsp;<strong>注文番号</strong>&nbsp;NO.<%= order.order_number %></div>

                                        <div class="order-remove"><a href=""></a></div>
                                    </td>
                                </tr>
                                <tr>
                                    <% order_details.forEach(order_detail => { %>
                                    <td class="order-item--data">
                                        <div class="order-item--img"><img src="/image/item-image/<%= JSON.parse(order_detail.img)[0] %>" alt=""></div>
                                        <div class="order-item--info">
                                            <div class="order-item--name"><strong><%= order_detail.item_name %></strong></div>
                                            <div class="order-item--brand"><strong>ブランド: </strong><%= order_detail.brand %></div>
                                            <div class="order-item--color"><strong>カラー: </strong><%= order_detail.color %></div>
                                            <div class="order-item--size"><strong>サイズ: </strong><%= order_detail.size %></div>
                                            <div class="order-item--quantity"><strong>数量: </strong><%= order_detail.quantity %></div>
                                        </div>
                                    </td>
                                    <% }) %>
                                    <td>¥<%= order.total_amount %></td>
                                    <td>
                                        <div class="order-item--return" style="text-wrap: nowrap;padding: 10px; color: var(--primary-color); "><a href="">商品を返品</a></div>
                                        <div class="order-item--repurchase" style="text-wrap: nowrap;padding: 10px; color: var(--primary-color);"><a href="">再購入</a></div>
                                    </td>
                                    <td class="order-item--status-info">
                                        <div class="order-item--status">
                                            <%= order.status == 'pending' ? '未処理' :order.status == "delivered" ? '配送待ち' : order.status == 'shipping' ? '配送中' : order.status == 'shipped' ? '配送済み' : 'キャンセル' %>
                                        </div>
                                        <div class="order-info" onclick="showOrderInfo()">
                                           注文詳細
                                        </div>
                                    </td>
                                    <td><a href="" class="order-item--review">レビュー</a></td>
                                </tr>
                                <% }) %>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container end -->

        <!-- Footer Start -->
        <div class="footer">
            <div class="grid wide">
                <div class="row">
                    <div class="col l-3 c-6">
                        <h1 class="shop-infor-title">会社情報</h1>
                        <div class="shop-infor-list"><a href="">TS-Shopについて</a></div>
                        <div class="shop-infor-list"><a href="">お問い合わせ</a></div>
                        <div class="shop-infor-list"><a href="">採用情報</a></div>
                        <div class="shop-infor-list"><a href="">TS-Shopが取り組む環境活動</a></div>
                    </div>
                    <div class="col l-3 c-6">
                        <h1 class="shop-poricy-title">カスタマーサービス</h1>
                        <div class="shop-poricy-list"><a href="">返品・返金ポリシー</a></div>
                        <div class="shop-poricy-list"><a href="">配送について</a></div>
                    </div>
                    <div class="col l-3 c-6">
                        <h1 class="shop-help-title">へプル</h1>
                        <div class="shop-help-list"><a href="">サポートセンター＆FAQ</a></div>
                    </div>
                    <div class="col l-3 c-6">
                        <h1 class="shop-media-title">TS-SHOPとつながる</h1>
                        <ul class="row shop-media-list">
                            <li class="col l-4"><a href="https://instagram.com" class="shop-media-list_insta"><i class="fa-brands fa-instagram"></i></a></li>
                            <li class="col l-4"><a href="https://facebook.com" class="shop-media-list_fb"><i class="fa-brands fa-facebook"></i></a></li>
                            <li class="col l-4"><a href="https://twitter.com/" class="shop-media-list_tw"><i class="fa-brands fa-x-twitter"></i></a></li>
                            <li class="col l-4"><a href="https://tiktok.com" class="shop-media-list_tiktok"><i class="fa-brands fa-tiktok"></i></a></li>
                            <li class="col l-4"><a href="https://youtube.com" class="shop-media-list_ytb"><i class="fa-brands fa-youtube"></i></a></li>
                            <li class="col l-4"><a href="https://www.pinterest.jp/" class="shop-media-list_pinterest"><i class="fa-brands fa-pinterest"></i></a></li>
                            
                    </div>
                </div>
                <div class="row shop-detail">
                        TS-SHOP（ティィエスショップ）とは<br>
TS-SHOPはレディースからメンズ・キッズまで、幅広いジャンルのファストファッションアイテムをまとめて購入できるファッション通販サイトです。最新のファストファッションアイテムを取り揃え、様々なお支払い方法にてお買い求めいただけます。お得なセールやイベントも365日毎日開催しておりますので、是非ファッション通販サイトTS-SHOPでのお買い物をお楽しみください！
                </div>
            </div>
            <div class="footer-index">© THANHSON TS-SHOP, ALL RIGHTS RESERVED</div>
        </div>
        <!-- Footer End -->
    </div>
</body>
<script src="/script/script.js"></script>
<script>
    function showOrderInfo() {
    $('.user-profile__content').innerHTML =
        `<div class="order-info-modal">注文詳細</div>
    <div class ="row order-page-return">
        <a href="/user-order"><i class="fa-solid fa-chevron-left"></i>戻る</a>
    </div>

    <div class="row order-page-info__number">
        <div class="col l-6">
            注文番号
        </div>
        <div class="col l-6">
            1234567890
        </div>
    </div>
    <div class="row order-page-info__action">
        <div class="order-repurchase">再購入</div>
        <div class="order-return">返品</div>
        <div class="order-tracking">追跡</div>
        <div class="order-review">レビュー</div>
    </div>
    <table class="order-page-info__table">
        <tr>
            <th>商品情報</th>
            <th>数量</th>
            <th>金額</th>
            <th>ステータス</th>
            <th>アクション</th>
        </tr>
        <% order_details.forEach(order_detail => { %>
        <tr>
            <td>
                <div class="order-item--img"><img src="/image/item-image/<%= JSON.parse(order_detail.img)[0] %>" alt=""></div>
                <div class="order-item--info">
                    <div class="order-item--name"><strong><%= order_detail.item_name %></strong></div>
                    <div class="order-item--brand"><strong>ブランド: </strong><%= order_detail.brand %></div>
                    <div class="order-item--color"><strong>カラー: </strong><%= order_detail.color %></div>
                    <div class="order-item--size"><strong>サイズ: </strong><%= order_detail.size %></div>
                </div>
            </td>
            <td><%= order_detail.quantity %></td>
            <td><%= order_detail.price %></td>
            <td><%= order_detail.status == 'pending' ? '未処理' : order_detail.status == "delivered" ? '配送待ち' : order_detail.status == 'shipping' ? '配送中' : order_detail.status == 'shipped' ? '配送済み' : 'キャンセル' %></td>
            <td><a href=""><%= order_detail.status == 'pending' ? 'キャンセル' : '' %></a></td>
        </tr>
        <% }) %>
    </table>
    <div class="order-page-info__total">
        <div class="order-page-info__item--price">
            <div>小計</div>
            <div>¥<%= orders.total_amount %></div>
        </div>
        <div class="order-page-info__item--shipping">
            <div>送料</div>
            <div>¥<%= orders.shipping_fee %></div>
        </div>
        <div class="order-page-info__item--total">
            <div>合計</div>
            <div>¥<%= orders.total_amount + orders.shipping_fee %></div>
        </div>
    </div>
    <div class="order-page-info__tracking">
        <div class="order-page-info__tracking--title">配送情報</div>
        <div class="order-page-info__tracking--item">
            <div><%= orders.order_username %>  <%= orders.shipping_address %></div>
            <div><%= orders.shipping_company %></div>
        </div>
    </div>
    `;
}
</script>
<script>
    function decreaseQuantityValue(a){
        const quantityElement = a.parentElement.closest('.cart__item--info-quantity');
        var quantityValue = parseInt(quantityElement.querySelector('.cart__item--info-quantity-num').innerText);
        if(quantityValue == 1){
            removeItemCart(a);
        }
        else{
            quantityValue--;
            quantityElement.querySelector('.cart__item--info-quantity-num').innerText=quantityValue;
        }
    }
    function increaseQuantityValue(a){
        const quantityElement = a.parentElement.closest('.cart__item--info-quantity');
        var quantityValue = parseInt(quantityElement.querySelector('.cart__item--info-quantity-num').innerText);
        quantityValue++;
        quantityElement.querySelector('.cart__item--info-quantity-num').innerText=quantityValue;    
    }
    function removeItemCart(a){
        window.location.reload();
    }
</script>
</html>