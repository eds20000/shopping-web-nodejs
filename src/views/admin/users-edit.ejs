<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/style/base.css">
    <link rel="stylesheet" href="/style/grid.css">
    <link rel="stylesheet" href="/style/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/d72dd2144a.js" crossorigin="anonymous"></script>  
    <link rel="stylesheet" href="/style/responsive.css">
    <link rel="stylesheet" href="/style/admin/admin-page.css">
    <title>Admin-page</title>
    <script>
        const list_users = JSON.parse('<%- JSON.stringify(users) %>');
    </script>
</head>

<body>
    <header class="header header-only">
        <div class="grid wide">
            <a href="/" class="header__logo"><img src="/image/logo.png" alt="logo" class="logo-img"></a>
        </div> 
    </header>
    <div class="container_ad">
        <div class="grid wide">
            <div class="row">
                <div class="col l-2 ad_page-category">
                    <% users.forEach(user => { %>
                        <% if(user.user_role == 'admin'){ %>
                    <div class="ad_category-img"><img src="/image/user-image/<%=user.user_img %>" alt="user-image"></div>
                    <div class="ad_category-name"><%=user.user_name %></div>
                        <% } %>
                    <% }) %>
                    <ul class="ad_page-category-content">
                        <li class="ad_category"><a href="http://">カテゴリー</a></li>
                        <li class="ad_item"><a href="/admin-page">製品</a></li>
                        <li class="ad_order"><a href="http://">注文</a></li>
                        <li class="ad_cutomer ad-checked"><a href="/admin-users">顧客</a></li>
                        <li class="ad_review"><a href="http://">レビュー</a></li>
                    </ul>
                </div>
                <div class="col l-10 ad_page-content">
                    <div class="row content-title ">
                        <div class="ad_page-user-title ad-content-title-checked">顧客リスト</div>
                    </div>
                    <div class="row" style="margin-bottom: 20px;">
                        <div class="item-total">
                            人数：
                            <div class="number"><%= users.length %></div>人
                        </div>
                        <a href="/user-add" class="user-addBtn primary-btn" style="font-size: 1.5rem; width: 80px;">+追加</a>
                    </div>
                    <table class="ad_page-user-list">
                        <tr>
                            <th>ID</th>
                            <th>ユーザー名</th>
                            <th>メールアドレス</th>
                            <th>性別</th>
                            <th>誕生日</th>
                            <th>作成時</th>
                            <th>動作</th>
                        </tr>
                        <% users.forEach(user => { %>
                            <tr>
                                <td><%= user.user_id %></td>
                                <td class="user-nameImg">
                                    <div class="user-img"><img src="/image/user-image/<%= user.user_img %>" alt=""></div>
                                    <div class="user-name"><%= user.user_name %></div>
                                </td>
                                <td><%= user.user_email %></td>
                                <td><%= user.user_sex %></td>
                                <td><%= user.user_birth %></td>
                                <td><%= user.created_at %></td>
                                <td>
                                    <div class="action-box" style="display: flex; gap: 10px; height:100%;">
                                        <div class="action-edit"><a href="/users-edit/<%= user.user_id %>">更新</a></div>
                                        <div class="action-delete"><a href="#" onclick="deleteUser(<%=user.user_id %>)">削除</a></div>
                                    </div>
                                    
                                </td>
                            </tr>
                        <% }) %>
                    </table>
                </div>
            </div>
        </div>
        <div class="warning-delete-box-background">
            <div class="warning-delete-box">
            </div>
        </div>
    </div>
    <script>
        function deleteUser(id) {
    document.querySelector('.warning-delete-box-background').style.display = 'flex'
    let selectUser = list_users.find((user) => user.user_id == id)
    if (selectUser) {
        document.querySelector('.warning-delete-box').innerHTML = `
        <div class="warning-delete-title">
                <h2>Delete User</h2>
                <div class="warning-delete-box-close"><i class="fa-solid fa-xmark"></i></div>
            </div>
            <div class="warning-delete-content">
                Are you sure to delete User:<br>
                <div class="warning-delete-content-item">
                    <img class="item-img" src="/image/user-image/${selectUser.user_img}" alt="item-img">
                    ${selectUser.user_name}
                </div>      
            </div>
            <div class="warning-delete-action">
                <div class="warning-delete-cancel">キャンセル</div>
                <a href="/users-delete/${selectUser.user_id}" class="warning-delete-sure">削除</a>
            </div>
        
        `
    }
    if (document.querySelector('.warning-delete-box-close')) {
        document.querySelector('.warning-delete-box-close').onclick = function () {
            document.querySelector('.warning-delete-box-background').style.display = 'none'
        }
    }
    if (document.querySelector('.warning-delete-cancel')) {
        document.querySelector('.warning-delete-cancel').onclick = function () {
            document.querySelector('.warning-delete-box-background').style.display = 'none'
        }
    }
}
    </script>
</body>
</html>